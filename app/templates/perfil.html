{% extends "base.html" %}

    {% block other_style %}
        <link rel="stylesheet" href="{{ url_for('static', filename='css/perfil.css')}}">
    {% endblock 
        %}
    {% block title %}Perfil{% endblock %}

{% block content %}
    <section id="msg-bemvindo">
        Bem vindo, {{ usuario.nome_completo }}!
        <hr>
    </section>

    <div id="dados-usuario">
    <div class="dados-container">

        <div class="dados-lista">
            <div class="dado-item">
                <span class="dado-label">Nome completo:</span>
                <div class="dado-content">
                    <span class="dado-valor" id="nome-completo">{{ usuario.nome_completo }}</span>
                    <input type="text" class="dado-input" id="input-nome" value="{{ usuario.nome_completo }}" style="display: none;">
                </div>
            </div>

            <div class="dado-item">
                <span class="dado-label">E-mail:</span>
                <div class="dado-content">
                    <span class="dado-valor" id="email">{{ usuario.email }}</span>
                    <input type="email" class="dado-input" id="input-email" value="{{ usuario.email }}" style="display: none;">
                </div>
            </div>

            <div class="dado-item">
                <span class="dado-label">Telefone:</span>
                <div class="dado-content">
                    <span class="dado-valor" id="telefone">{{ usuario.telefone_res if usuario.telefone_cel else "Não informado" }}</span>
                    <input type="tel" class="dado-input" id="input-telefone" value="{{ usuario.telefone }}" style="display: none;">
                </div>
            </div>

            <div class="dado-item">
                <span class="dado-label">Endereço:</span>
                <div class="dado-content">
                    <span class="dado-valor" id="endereco">{{ usuario.rua }}, {{ usuario.numero }}, {{ usuario.cep }}</span>
                    <input type="text" class="dado-input" id="input-cep" value="{{ usuario.cep }}" style="display: none;">
                    <input type="text" class="dado-input" id="input-rua" value="{{ usuario.rua }}" style="display: none;">
                    <input type="text" class="dado-input" id="input-numero" value="{{ usuario.numero }}" style="display: none;">
                </div>
            </div>

            <div class="dado-item" id="dado-senha" style="display: none;">
                <span class="dado-label">Senha:</span>
                <div class="dado-content">
                    <input type="password" class="dado-input" id="input-nova-senha" placeholder="Nova senha" style="display: none;">
                </div>
            </div>

            <div class="dados-stats">
                <div class="stat-item">
                    <span class="stat-numero">{{ qtd_leiloes_part }}</span>
                    <span class="stat-label">leilões participados</span>
                </div>

                <div class="stat-item">
                    <span class="stat-numero">{{ qtd_leiloes_criados }}</span>
                    <span class="stat-label">leilões criados</span>
                </div>
            </div>
        </div>
    </div>
</div>

    <div id="botoes-salvar" style="display: none;">
        <button type="click" id="btn-salvar" class="btn-salvar">Salvar alterações</button>
        <button type="click" id="btn-cancelar" class="btn-cancelar">Cancelar</button>
    </div>

    <div id="msg-editar-conta">
        <section id="mensagem"></section>
    </div>

    <div id="opcoes">
        <form action="{{ url_for('main.logout') }}" method="POST">
            <button type="submit" id="btn-sair">Sair</button>
        </form>

        <button type="button">Apagar minha conta</button>
        <button type="click" id="btn-editar" onclick="exibirCampoDados()">Editar Perfil</button>
    </div>

    <div id="leiloes-user">
        <section id="msg-leiloes">
            Seus leilões
            <hr>
        </section>

        <div id="leiloes-criados">
            <div class="carrossel-leiloes">
                {% if leiloes_usuario %}
                    {% for leilao in leiloes_usuario %}
                        <a href="{{ url_for('main.detalhes_leilao', hashid=leilao.hashid)}}" class="leilao-link">
                        <div class="leilao-card">
                            <img src="{{ leilao.get_foto() }}"><br>
                            {{ leilao.nome }}
                            <br><p id="local">{{ leilao.cidade }} - {{ leilao.uf }}</p><br>
                
                            <div id="infos-leiloeiro">
                                <img src="{{ url_for('static', filename='img/icons-img/profile.png')}}">
                                <span id="leiloeiro-texto">{{ leilao.user.nome_completo }}</span>
                            </div>
                
                            <div id="views-img">
                                <img src="{{ url_for('static', filename='img/icons-img/views-icon.png') }}">
                                <span id="views-count">{{ leilao.lances|length }} lances</span>
                            </div><br>
                        
                            <span id="lance-atual">
                                Lance atual: 
                                {% if leilao.lances %}
                                    {{ (leilao.lances|sort(attribute='valor')|last).get_valor_str() }}
                                {% else %}
                                    {{ leilao.get_lance_inicial_str() }}
                                {% endif %}
                            </span><br>
                            <span id="temporizador" data-fim="{{ leilao.data_fim }}">
                                Encerra em: {{ leilao.data_fim }}
                            </span>
                            <p id="temp"></p>
                        </div>
                        </a>
                    {% endfor %}
                
                {% else %}
                    <section class="mensagem-semleilao">
                        Você ainda não criou nenhum leilão<br>
                        Vá para nossa página inicial e explore os leilões disponíveis!<br>
                        <button type="click" id="btn-home">Página inicial</button>
                    </section>
            {% endif %}
                
            </div>
        </div>

        <div id="leiloes-participante">
            <section id="msg-leiloes">
                Leilões que você está participando
                <hr>
            </section>

            <div class="carrossel-leiloes">
            {% for item in leiloes_participados.values() %}
            {% if item.leilao.status == "Aberto" %}
                <a href="{{ url_for('main.detalhes_leilao', hashid=item.leilao.hashid)}}" class="leilao-link">
                <div class="leilao-card">
                    <img src="{{ item.leilao.get_foto() }}"><br>
                    {{ item.leilao.nome }}
                    <br><p id="local">{{ item.leilao.cidade }} - {{ item.leilao.uf }}</p><br>
                
                    <div id="infos-leiloeiro">
                        <img src="{{ url_for('static', filename='img/icons-img/profile.png')}}">
                        <span id="leiloeiro-texto">{{ item.leilao.user.nome_completo }}</span>
                    </div>
                
                    <div id="views-img">
                        <img src="{{ url_for('static', filename='img/icons-img/views-icon.png') }}">
                        <span id="views-count">{{ item.lances|length }} lances</span>
                    </div><br>
                
                    <span id="lance-atual">Lance atual: {% if item.leilao.lances %}
                        {{ (item.leilao.lances|sort(attribute='valor')|last).get_valor_str() }}
                    {% else %}
                        {{ item.leilao.get_lance_inicial_str() }}
                    {% endif %}</span>
                    <span id="temporizador" data-fim="{{ item.data_fim }}">Encerra em: {{ item.data_fim }}</span>
                </div>
                </a>
            {% endif %}
            {% endfor %}
            </div>
        </div>

        <div id="leiloes-arrematados">
            <section id="msg-leiloes">
                Leilões arrematados
                <hr>
            </section>

            <div class="carrossel-leiloes">
                {% if usuario.comprovantes %}
                {% for comprovante in usuario.comprovantes %}
                <div class="leilao-card">
                    <img src="{{ comprovante.leilao.foto }}"><br>
                    {{ comprovante.leilao.nome }}
                    <br><p id="local">{{ comprovante.leilao.cidade }} - {{ comprovante.leilao.uf }}</p><br>

                    <div id="infos-leiloeiro">
                        <img src="{{ url_for('static', filename='img/icons-img/profile.png')}}">
                        <span id="leiloeiro-texto">{{ comprovante.leilao.user.nome_completo }}</span>
                    </div>
                
                    <div id="views-img">
                        <img src="{{ url_for('static', filename='img/icons-img/views-icon.png') }}">
                        <span id="views-count">{{ comprovante.leilao.lances|length }} Lances</span>
                    </div><br>
                </div>
                {% endfor %}
                {% else %}
                <h3>Não há leilões arrematados</h3>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="historico-leiloes">
        <section id="msg-leiloes">
            Histórico de Lances
            <hr>
        </section>

        <table id="tabela-historico">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Valor do Lance</th>
                <th>Data/Hora</th>
            </tr>
        </thead>
        <tbody>
            {% for item in leiloes_participados.values() %}
                {% for lance in item.lances %}
                <tr>
                    <td>{{ item.leilao.nome }}</td>
                    <td>R$ {{ lance.valor }}</td>
                    <td>{{ lance.horario.strftime("%d/%m/%Y %H:%M:%S") }}</td>
                </tr>
                {% endfor %}
            {% endfor %}
        </tbody>
        </table>
    </div><br><br><br><br>

{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='script/style.js') }}"></script>
    <script src="{{ url_for('static', filename='script/alterar_cadastro.js')}}"></script>
{% endblock %}